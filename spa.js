import {
    supabase
} from './supabase.js';
const container = document.getElementById('song-list');
const searchInput = document.getElementById('search');
let currentSongs = [];
let hiddenIds = [];
async function loadSongs() { // Prendi le canzoni nascoste const { data: hiddenData } = await supabase.from('hidden_songs').select('*'); hiddenIds = hiddenData.map(h => h.song_id); // Prendi tutte le canzoni const { data: songsData, error } = await supabase .from('song_counts') .select('*') .order('requests', { ascending: false }) .order('title', { ascending: true }); if (error) { console.error('Errore caricamento canzoni:', error); return; } currentSongs = songsData.filter(s => !hiddenIds.includes(s.id)); renderSongs(); } function renderSongs() { const searchTerm = searchInput.value.toLowerCase(); const filtered = currentSongs.filter( s => s.title.toLowerCase().includes(searchTerm) || (s.artist && s.artist.toLowerCase().includes(searchTerm)) ); container.innerHTML = filtered.map(s => <div class="song"> <div><strong>${s.title}</strong>${s.artist ? ' â€“ ' + s.artist : ''}</div> <div> <button data-id="${s.id}">Richiedi</button> <span class="count">(${s.requests})</span> </div> </div> ).join(''); container.querySelectorAll('button[data-id]').forEach(btn => { btn.onclick = async () => { const id = btn.dataset.id; btn.disabled = true; await supabase.from('requests').insert([{ song_id: id }]); btn.disabled = false; }; }); } // Aggiorna la lista in tempo reale searchInput.addEventListener('input', renderSongs); const requestsChannel = supabase.channel('realtime-requests') .on('postgres_changes', { event: '*', schema: 'public', table: 'requests' }, loadSongs) .on('postgres_changes', { event: '*', schema: 'public', table: 'hidden_songs' }, loadSongs) .subscribe(); loadSongs();
